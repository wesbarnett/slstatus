*** a/slstatus.c	2017-03-16 07:38:28.050112122 -0500
--- b/slstatus.c	2017-03-28 21:35:27.094972748 -0500
***************
*** 63,68 ****
--- 63,69 ----
  static char *uptime(void);
  static char *username(void);
  static char *vol_perc(const char *card);
+ static char *vpn_status(const char *iface);
  static char *wifi_perc(const char *iface);
  static char *wifi_essid(const char *iface);
  static void sighandler(const int signo);
***************
*** 103,121 ****
  battery_perc(const char *bat)
  {
  	int perc;
  	char path[PATH_MAX];
  	FILE *fp;
  
! 	snprintf(path, sizeof(path), "%s%s%s", "/sys/class/power_supply/", bat, "/capacity");
  	fp = fopen(path, "r");
  	if (fp == NULL) {
  		warn("Failed to open file %s", path);
  		return smprintf("%s", UNKNOWN_STR);
  	}
! 	fscanf(fp, "%i", &perc);
  	fclose(fp);
  
! 	return smprintf("%d%%", perc);
  }
  
  static char *
--- 104,147 ----
  battery_perc(const char *bat)
  {
  	int perc;
+     int charge_now;
+     int charge_full_design;
  	char path[PATH_MAX];
  	FILE *fp;
  
! 	snprintf(path, sizeof(path), "%s%s%s", "/sys/class/power_supply/", bat, "/charge_full_design");
  	fp = fopen(path, "r");
  	if (fp == NULL) {
  		warn("Failed to open file %s", path);
  		return smprintf("%s", UNKNOWN_STR);
  	}
!     fscanf(fp, "%i", &charge_full_design);
  	fclose(fp);
  
! 	snprintf(path, sizeof(path), "%s%s%s", "/sys/class/power_supply/", bat, "/charge_now");
! 	fp = fopen(path, "r");
! 	if (fp == NULL) {
! 		warn("Failed to open file %s", path);
! 		return smprintf("%s", UNKNOWN_STR);
! 	}
!     fscanf(fp, "%i", &charge_now);
! 	fclose(fp);
! 
!     perc = (int)(100.0*((double)charge_now/(double)charge_full_design));
! 
!     if (perc <= battery_urgent)
!     {
! 	    return smprintf("%d%%", perc);
!     }
!     else if (perc <= battery_low)
!     {
! 	    return smprintf("%d%%", perc);
!     }
!     else
!     {
!   	    return smprintf("%d%%", perc);
!     }
! 
  }
  
  static char *
***************
*** 135,145 ****
  	fclose(fp);
  
  	if (strcmp(state, "Charging") == 0) {
! 		return smprintf("+");
  	} else if (strcmp(state, "Discharging") == 0) {
! 		return smprintf("-");
  	} else if (strcmp(state, "Full") == 0) {
! 		return smprintf("=");
  	} else {
  		return smprintf("?");
  	}
--- 161,171 ----
  	fclose(fp);
  
  	if (strcmp(state, "Charging") == 0) {
!         return smprintf("\U0001F50C");
  	} else if (strcmp(state, "Discharging") == 0) {
! 		return smprintf("\U0001F50B");
  	} else if (strcmp(state, "Full") == 0) {
! 		return smprintf("F");
  	} else {
  		return smprintf("?");
  	}
***************
*** 186,192 ****
  		return smprintf("%s", UNKNOWN_STR);
  	}
  
! 	return smprintf("%s", str);
  }
  
  static char *
--- 212,218 ----
  		return smprintf("%s", UNKNOWN_STR);
  	}
  
! 	return smprintf("%s", str);
  }
  
  static char *
***************
*** 683,689 ****
  
  	close(afd);
  
! 	return smprintf("%d%%", v & 0xff);
  }
  
  static char *
--- 709,752 ----
  
  	close(afd);
  
!     if ((v & 0xff) < 1) 
!     {
! 	    return smprintf("\U0001F507  %d%%", v & 0xff);
!     }
!     else if ((v & 0xff) < 10)
!     {
! 	    return smprintf("\U0001F508  %d%%", v & 0xff);
!     }
!     else if ((v & 0xff) < 30)
!     {
! 	    return smprintf("\U0001F508 %d%%", v & 0xff);
!     }
!     else if ((v & 0xff) < 65)
!     {
! 	    return smprintf("\U0001F509 %d%%", v & 0xff);
!     }
!     else
!     {
! 	    return smprintf("\U0001F50A %d%%", v & 0xff);
!     }
! }
! 
! static char *
! vpn_status(const char *iface)
! {
! 	char path[PATH_MAX];
! 	char status[5];
! 	FILE *fp;
! 	snprintf(path, sizeof(path), "%s%s%s", "/sys/class/net/", iface, "/operstate");
! 	fp = fopen(path, "r");
! 	if (fp == NULL) {
! 		return smprintf("\U0001F513");
! 	}
! 	fgets(status, 5, fp);
! 	fclose(fp);
! 	if(strcmp(status, "down\n") != 0) {
! 		return smprintf("\U0001F512");
! 	}
  }
  
  static char *
***************
*** 725,731 ****
  	datastart = (datastart+(strlen(iface)+1));
  	sscanf(datastart + 1, " %*d   %d  %*d  %*d		  %*d	   %*d		%*d		 %*d	  %*d		 %*d", &perc);
  
! 	return smprintf("%d%%", perc);
  }
  
  static char *
--- 788,801 ----
  	datastart = (datastart+(strlen(iface)+1));
  	sscanf(datastart + 1, " %*d   %d  %*d  %*d		  %*d	   %*d		%*d		 %*d	  %*d		 %*d", &perc);
  
!     if (perc < wifi_low)
!     {
! 	    return smprintf("%d%%", perc);
!     }
!     else
!     {
! 	    return smprintf("%d%%", perc);
!     }
  }
  
  static char *
